<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SkyCommand</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
<style>
body { background:#f8fafc; }
header,section{margin-bottom:2rem;}
table{width:100%;}
.dashboard-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;}
.card{padding:1.5rem;background:#fff;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
.card:hover{transform:translateY(-4px);box-shadow:0 6px 16px rgba(0,0,0,0.1);}
tr:hover{background-color:#eef6ff;}
</style>
</head>
<body>
<nav class="container-fluid">
<ul><li><strong>SkyCommand</strong></li></ul>
<ul>
<li><a href="#dashboard">Dashboard</a></li>
<li><a href="#metar">METAR</a></li>
<li><a href="#charts">Charts</a></li>
<li><a href="#logging">Log Flight</a></li>
</ul>
</nav>

<main class="container">

<header>
<h1>Welcome to SkyCommand</h1>
<a href="https://skycommand.onrender.com/auth/discord" role="button">Login with Discord</a>
</header>

<section id="dashboard">
<h2>Dashboard</h2>
<div class="dashboard-cards">
<div class="card"><h3>Total Flight Hours</h3><p id="flight-hours">Loading...</p></div>
<div class="card"><h3>Total Flights</h3><p id="total-flights">Loading...</p></div>
</div>
<h3>Recent Flights</h3>
<table>
<thead><tr><th>Date</th><th>From</th><th>To</th><th>Duration</th></tr></thead>
<tbody id="recent-flights"></tbody>
</table>
</section>

<section id="logging">
<h2>Flight Logging</h2>
<form id="log-form" class="grid" enctype="multipart/form-data">
<input type="text" name="callsign" placeholder="Callsign" required>
<input type="text" name="aircraft" placeholder="Aircraft" required>
<input type="text" name="from" placeholder="Departure ICAO" required>
<input type="text" name="to" placeholder="Arrival ICAO" required>
<input type="number" name="altitude" placeholder="Altitude (ft)" required>
<textarea name="remarks" placeholder="Remarks"></textarea>
<input type="file" name="screenshot" accept="image/*" required>
<button type="submit">Submit Flight Log</button>
</form>
<div id="log-status"></div>
</section>

<section id="charts">
<h2>Airport Charts</h2>
<form id="charts-form" class="grid">
<input type="text" id="charts-icao" placeholder="Enter ICAO" required>
<button type="submit">Get Charts</button>
</form>
<div id="charts-display"></div>
</section>

</main>

<script>
// Load stats from backend
async function loadDashboard() {
  const res = await fetch("https://skycommand.onrender.com/api/stats");
  const data = await res.json();
  document.getElementById("flight-hours").innerText = data.totalHours + " hrs";
  document.getElementById("total-flights").innerText = data.totalFlights;
  document.getElementById("recent-flights").innerHTML = data.recentFlights.map(f => `
    <tr><td>${f.date}</td><td>${f.from}</td><td>${f.to}</td><td>${f.duration}</td></tr>
  `).join("");
}
loadDashboard();

// Flight Logging
document.getElementById("log-form").addEventListener("submit", async (e) => {
e.preventDefault();
const form = e.target;
const formData = new FormData(form);
const res = await fetch("https://skycommand.onrender.com/api/log", { method: "POST", body: formData });
const result = await res.json();
document.getElementById("log-status").innerText = result.message || "Flight logged!";
form.reset();
});

// Charts
document.getElementById("charts-form").addEventListener("submit", async (e) => {
e.preventDefault();
const icao = document.getElementById("charts-icao").value;
const res = await fetch(`https://skycommand.onrender.com/api/charts?icao=${icao}`);
const charts = await res.json();
document.getElementById("charts-display").innerHTML = charts.map(c => `
  <a href="${c.url}" target="_blank">${c.name}</a><br>
`).join("");
});
</script>

</body>
</html>