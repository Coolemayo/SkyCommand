<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyCommand Flight Logging & Stats</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 2rem;
    background: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1470&q=80') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
  }
  h1, h2 {
    text-align: center;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
  }
  form {
    display: grid;
    gap: 1rem;
    max-width: 400px;
    margin: 2rem auto;
    background: rgba(0,0,0,0.6);
    padding: 1.5rem;
    border-radius: 12px;
  }
  input, button {
    padding: 0.6rem;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
  }
  button {
    cursor: pointer;
    background-color: #001f4d; /* Navy blau */
    color: white;
    font-weight: bold;
    transition: background 0.3s, transform 0.2s;
  }
  button:hover {
    background-color: #003366;
    transform: translateY(-2px);
  }
  #log-status, #stats {
    margin-top: 1rem;
    font-weight: bold;
    text-align: center;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
  }
</style>
</head>
<body>

<h1>SkyCommand Flight Logging</h1>

<form id="log-form">
  <input type="text" name="Depature" placeholder="Dep. ICAO" required>
  <input type="text" name="Arrival" placeholder="Arr. ICAO" required>
  <input type="text" name="Callsign" placeholder="Callsign" required>
  <input type="text" name="aircraft" placeholder="Aircraft" required>
  <input type="text" name="altitude" placeholder="altitude" required>
  <input type="text" name="remarks"  placeholder="remarks" 
  <input type="file" name="screenshot" id="screenshot" accept="image/*" required>
  <button type="submit">Submit Log</button>
</form>

<div id="log-status"></div>

<h2>Flight Statistics</h2>
<div id="stats">Loading...</div>

<script>
const allowedICAO = ["LCLK","LCPH","LCRA","MDPC","MDAB","MDST","EGKK","EGHI","GLCP","LEHM","EFKT"];
const allowedAircraft = ["B737-800"];

// Flight Logging Handler
document.getElementById("log-form").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const from = e.target.from.value.trim().toUpperCase();
  const to = e.target.to.value.trim().toUpperCase();
  const duration = e.target.duration.value.trim();
  const aircraft = e.target.aircraft.value.trim();
  const screenshot = e.target.screenshot.files[0];

  if(!allowedICAO.includes(from)){document.getElementById("log-status").innerText="Ung端ltiger From ICAO Code!";return;}
  if(!allowedICAO.includes(to)){document.getElementById("log-status").innerText="Ung端ltiger To ICAO Code!";return;}
  if(isNaN(duration)||duration<=0){document.getElementById("log-status").innerText="Ung端ltige Dauer!";return;}
  if(!allowedAircraft.includes(aircraft)){document.getElementById("log-status").innerText="Ung端ltiges Flugzeug!";return;}
  if(!screenshot){document.getElementById("log-status").innerText="Bitte Screenshot hochladen!";return;}

  document.getElementById("log-status").innerText="Submitting flight log...";

  try{
    const formData = new FormData();
    formData.append("from", from);
    formData.append("to", to);
    formData.append("duration", duration);
    formData.append("aircraft", aircraft);
    formData.append("screenshot", screenshot);

    const res = await fetch("https://skycommand-backend.onrender.com/api/flights", {
      method:"POST",
      credentials:"include",
      body:formData
    });
    const data = await res.json();
    document.getElementById("log-status").innerText = data.success ? "Flight logged successfully!" : "Fehler beim Speichern!";
    if(data.success) e.target.reset();
    loadStats(); // Stats aktualisieren nach Logging
  }catch(err){
    document.getElementById("log-status").innerText="Fehler: "+err.message;
  }
});

// Flight Statistics
async function loadStats(){
  try{
    const res = await fetch("https://skycommand-backend.onrender.com/api/stats");
    const data = await res.json();
    if(data.success){
      document.getElementById("stats").innerHTML=`
        Total Flights: ${data.totalFlights}<br>
        Total Hours: ${data.totalHours} hrs
      `;
    }else{
      document.getElementById("stats").innerText="Stats konnten nicht geladen werden.";
    }
  }catch(err){
    document.getElementById("stats").innerText="Fehler: "+err.message;
  }
}

loadStats();
</script>

</body>
</html>